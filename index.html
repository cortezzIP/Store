<!DOCTYPE html>
<html>

<head>
    <title>Store Interface</title>
    <link rel="shortcut icon" href="images/favicon.png" type="image/png">
    <link href="css/style.css" rel="stylesheet">
    <!-- <link data-loader="cdn" crossorigin="anonymous" href="https://aadcdn.msftauth.net/ests/2.1/content/cdnbundles/converged.v2.login.min_1ito3russhq-9gioj-zd4w2.css" rel="stylesheet" /> -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.1/dist/web3.min.js"></script>
    <script type="module" src="js/scripts.js"></script>
</head>

<body>
    <div class="w-full max-w-md px-4 mx-auto my-auto space-y-8 sm:px-6 md:px-8">
        <div class="flex flex-col space-y-4">
            <h1>Store Interface</h1>

            <h2>Create Product</h2>
            <input id="productId" class="block w-full h-10 transition duration-75 border-gray-300 rounded-lg shadow-sm focus:ring-1 focus:ring-inset focus:ring-cyan-500 focus:border-cyan-500" type="number" placeholder="Product ID">
            <input id="productName" class="block w-full h-10 transition duration-75 border-gray-300 rounded-lg shadow-sm focus:ring-1 focus:ring-inset focus:ring-cyan-500 focus:border-cyan-500" type="text" placeholder="Product Name">
            <input id="productPrice" class="block w-full h-10 transition duration-75 border-gray-300 rounded-lg shadow-sm focus:ring-1 focus:ring-inset focus:ring-cyan-500 focus:border-cyan-500" type="number" placeholder="Product Price">
            <button onclick="createProduct()" class="inline-flex items-center justify-center px-4 font-semibold tracking-tight text-white transition rounded-lg shadow font-brand bg-cyan-500 h-9 hover:bg-cyan-400 focus:bg-cyan-600 focus:outline-none focus:ring-offset-2 focus:ring-offset-cyan-600 focus:ring-2 focus:ring-white focus:ring-inset">Create</button>

            <h2>Add Supplier</h2>
            <input id="supplierAddress" class="block w-full h-10 transition duration-75 border-gray-300 rounded-lg shadow-sm focus:ring-1 focus:ring-inset focus:ring-cyan-500 focus:border-cyan-500" type="text" placeholder="Supplier Address">
            <input id="supplierRating" class="block w-full h-10 transition duration-75 border-gray-300 rounded-lg shadow-sm focus:ring-1 focus:ring-inset focus:ring-cyan-500 focus:border-cyan-500" type="number" placeholder="Supplier Rating">
            <button onclick="addSupplier()" class="inline-flex items-center justify-center px-4 font-semibold tracking-tight text-white transition rounded-lg shadow font-brand bg-cyan-500 h-9 hover:bg-cyan-400 focus:bg-cyan-600 focus:outline-none focus:ring-offset-2 focus:ring-offset-cyan-600 focus:ring-2 focus:ring-white focus:ring-inset">Add Supplier</button>

            <h2>Ship Product</h2>
            <input id="shipProductId" class="block w-full h-10 transition duration-75 border-gray-300 rounded-lg shadow-sm focus:ring-1 focus:ring-inset focus:ring-cyan-500 focus:border-cyan-500" type="number" placeholder="Product ID">
            <input id="shipStoreAddress" class="block w-full h-10 transition duration-75 border-gray-300 rounded-lg shadow-sm focus:ring-1 focus:ring-inset focus:ring-cyan-500 focus:border-cyan-500" type="text" placeholder="Store Address">
            <button onclick="shipProduct()" class="inline-flex items-center justify-center px-4 font-semibold tracking-tight text-white transition rounded-lg shadow font-brand bg-cyan-500 h-9 hover:bg-cyan-400 focus:bg-cyan-600 focus:outline-none focus:ring-offset-2 focus:ring-offset-cyan-600 focus:ring-2 focus:ring-white focus:ring-inset">Ship</button>

            <h2>Sell Product</h2>
            <input id="sellProductId" class="block w-full h-10 transition duration-75 border-gray-300 rounded-lg shadow-sm focus:ring-1 focus:ring-inset focus:ring-cyan-500 focus:border-cyan-500" type="number" placeholder="Product ID">
            <input id="sellBuyerAddress" class="block w-full h-10 transition duration-75 border-gray-300 rounded-lg shadow-sm focus:ring-1 focus:ring-inset focus:ring-cyan-500 focus:border-cyan-500" type="text" placeholder="Buyer Address">
            <button onclick="sellProduct()" class="inline-flex items-center justify-center px-4 font-semibold tracking-tight text-white transition rounded-lg shadow font-brand bg-cyan-500 h-9 hover:bg-cyan-400 focus:bg-cyan-600 focus:outline-none focus:ring-offset-2 focus:ring-offset-cyan-600 focus:ring-2 focus:ring-white focus:ring-inset">Sell</button>

            <h2>Return Product</h2>
            <input id="returnProductId" class="block w-full h-10 transition duration-75 border-gray-300 rounded-lg shadow-sm focus:ring-1 focus:ring-inset focus:ring-cyan-500 focus:border-cyan-500" type="number" placeholder="Product ID">
            <button onclick="returnProduct()" class="inline-flex items-center justify-center px-4 font-semibold tracking-tight text-white transition rounded-lg shadow font-brand bg-cyan-500 h-9 hover:bg-cyan-400 focus:bg-cyan-600 focus:outline-none focus:ring-offset-2 focus:ring-offset-cyan-600 focus:ring-2 focus:ring-white focus:ring-inset">Return</button>
        </div>
    </div>

    <script>
        function changePage() {
            const roleId = document.getElementById('roleId').value;
            switch (roleId) {
                case '1':
                    location.href = 'pages/admin.html';
                    break;
                case '2':
                    location.href = 'pages/supplier.html';
                    break;
                case '3':
                    location.href = 'pages/buyer.html';
                    break;
                case '4':
                    location.href = 'pages/seller.html';
                    break;
                case '5':
                    location.href = 'pages/store.html';
                    break;
            }
        }

        const web3 = new Web3('http://localhost:7545');

        const contractAddress = '0xc96B515beb953605201C090da3F155f71c93A1Cc';
        const abi = [{
            "constant": true,
            "inputs": [{
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }],
            "name": "products",
            "outputs": [{
                "internalType": "uint256",
                "name": "id",
                "type": "uint256"
            }, {
                "internalType": "string",
                "name": "name",
                "type": "string"
            }, {
                "internalType": "address",
                "name": "supplier",
                "type": "address"
            }, {
                "internalType": "address",
                "name": "store",
                "type": "address"
            }, {
                "internalType": "uint256",
                "name": "price",
                "type": "uint256"
            }],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        }, {
            "constant": true,
            "inputs": [{
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }],
            "name": "stores",
            "outputs": [{
                "internalType": "uint256",
                "name": "id",
                "type": "uint256"
            }],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        }, {
            "constant": true,
            "inputs": [{
                "internalType": "address",
                "name": "",
                "type": "address"
            }],
            "name": "suppliers",
            "outputs": [{
                "internalType": "address",
                "name": "addr",
                "type": "address"
            }, {
                "internalType": "uint256",
                "name": "rating",
                "type": "uint256"
            }],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        }, {
            "constant": true,
            "inputs": [{
                "internalType": "address",
                "name": "",
                "type": "address"
            }],
            "name": "users",
            "outputs": [{
                "internalType": "enum CStore.Roles",
                "name": "",
                "type": "uint8"
            }],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
        }, {
            "constant": false,
            "inputs": [{
                "internalType": "uint256",
                "name": "_id",
                "type": "uint256"
            }, {
                "internalType": "string",
                "name": "_name",
                "type": "string"
            }, {
                "internalType": "uint256",
                "name": "_price",
                "type": "uint256"
            }],
            "name": "createProduct",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
        }, {
            "constant": false,
            "inputs": [{
                "internalType": "uint256",
                "name": "_productId",
                "type": "uint256"
            }, {
                "internalType": "address",
                "name": "_store",
                "type": "address"
            }],
            "name": "shipProduct",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
        }, {
            "constant": false,
            "inputs": [{
                "internalType": "uint256",
                "name": "_productId",
                "type": "uint256"
            }, {
                "internalType": "address",
                "name": "_buyer",
                "type": "address"
            }],
            "name": "sellProduct",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
        }, {
            "constant": false,
            "inputs": [{
                "internalType": "uint256",
                "name": "_productId",
                "type": "uint256"
            }],
            "name": "returnProduct",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
        }, {
            "constant": false,
            "inputs": [{
                "internalType": "address",
                "name": "_addr",
                "type": "address"
            }, {
                "internalType": "uint256",
                "name": "_rating",
                "type": "uint256"
            }],
            "name": "addSupplier",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
        }, {
            "constant": false,
            "inputs": [{
                "internalType": "address",
                "name": "_addr",
                "type": "address"
            }, {
                "internalType": "enum CStore.Roles",
                "name": "_role",
                "type": "uint8"
            }],
            "name": "updateRole",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
        }];


        const store = new web3.eth.Contract(abi, contractAddress);

        web3.eth.defaultAccount = '0x09db776c7B23bcDD4f165a8c1b29197cAAFB688b';

        async function createProduct() {
            const productId = document.getElementById('productId').value;
            const productName = document.getElementById('productName').value;
            const productPrice = document.getElementById('productPrice').value;
            await store.methods.createProduct(productId, productName, productPrice).send({
                from: web3.eth.defaultAccount
            });
        }

        async function shipProduct() {
            const productId = document.getElementById('shipProductId').value;
            const storeAddress = document.getElementById('shipStoreAddress').value;
            await store.methods.shipProduct(productId, storeAddress).send({
                from: web3.eth.defaultAccount
            });
        }

        async function sellProduct() {
            const productId = document.getElementById('sellProductId').value;
            const buyerAddress = document.getElementById('sellBuyerAddress').value;
            await store.methods.sellProduct(productId, buyerAddress).send({
                from: web3.eth.defaultAccount
            });
        }

        async function returnProduct() {
            const productId = document.getElementById('returnProductId').value;
            await store.methods.returnProduct(productId).send({
                from: web3.eth.defaultAccount
            });
        }

        async function addSupplier() {
            const supplierAddress = document.getElementById('supplierAddress').value;
            const supplierRating = document.getElementById('supplierRating').value;
            await store.methods.addSupplier(supplierAddress, supplierRating).send({
                from: web3.eth.defaultAccount
            });
        }
    </script>
</body>

</html>